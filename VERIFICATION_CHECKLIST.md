# Gene-Forge v7.0 動作確認チェックリスト

## 概要

index.phpにおける全機能のUI操作・動作確認リスト。

## 自動テスト結果サマリ (2026-01-10)

### 正常動作確認済み
- [x] PHP構文チェック: 全ファイルエラーなし
- [x] メインページ読み込み: 正常 (HTTP 200)
- [x] 遺伝型推定: ルチノー♂ → INO: inoino (確定) ✓
- [x] 繁殖計算: Green × Aqua → 50% ♂グリーン, 50% ♀グリーン ✓

### 発見された問題
1. **繁殖計算結果表示バグ (修正済み)**
   - 原因: calculateOffspringの戻り値構造変更 (`results`キー追加)
   - 対応: index.php 1205-1218行目を修正

2. **PathFinder結果表示バグ (未修正・既存)**
   - 原因: PathFinderが翻訳キー(`title_key`等)を返すが、index.phpは翻訳済みテキストを期待
   - 影響: パスファインダー結果が空で表示される
   - 対応必要: lang_pathfinder.phpとindex.phpの連携修正

3. **親子関係ループ検出なし (修正済み)**
   - 原因: 個体登録時に循環参照をチェックしていなかった
   - 影響: 子孫を祖先に設定可能（論理矛盾）
   - 対応: birds.js に `validatePedigree()` 追加、app.js で保存時にチェック

---

## グローバル機能

### 言語切替
- [ ] 日本語(JA)切替が機能する
- [ ] 英語(EN)切替が機能する
- [ ] 言語設定がCookieに保存される

### モード切替
- [ ] デモモード(🎮)切替が機能する
- [ ] ユーザーモード(👤)切替が機能する
- [ ] モード切替時にDB個体リストが更新される

### タブナビゲーション
- [ ] 📁 個体管理タブへ遷移
- [ ] 🛡️ 健康評価タブへ遷移
- [ ] 🎯 作出計画タブへ遷移
- [ ] 🧭 パスファインダータブへ遷移
- [ ] 🧬 繁殖計算タブへ遷移
- [ ] 🔬 遺伝型推定タブへ遷移
- [ ] 👨‍👩‍👧‍👦 家系推論タブへ遷移

---

## Tab 0: 📁 個体管理 (birddb)

### 個体登録
- [ ] ➕ 個体追加モーダルが開く
- [ ] 名前入力が機能する
- [ ] コード入力（空欄時は自動生成）
- [ ] 性別選択が機能する
- [ ] 生年月日入力が機能する
- [ ] 系統入力が機能する
- [ ] 近交世代数入力が機能する
- [ ] 表現型（ベースカラー）選択が機能する
- [ ] 目の色選択が機能する
- [ ] ダーク因子選択が機能する
- [ ] 父親選択（DB連携）が機能する
- [ ] 母親選択（DB連携）が機能する
- [ ] 遺伝子型フィールドが性別に応じて切替わる
- [ ] 保存ボタンで個体が登録される
- [ ] キャンセルでモーダルが閉じる

### 個体編集・削除
- [ ] ✏️ 編集ボタンでモーダルが開く
- [ ] 既存データがフォームに反映される
- [ ] 🗑️ 削除ボタンで確認ダイアログが表示される
- [ ] 削除確認後に個体が削除される

### 血統書
- [ ] 📜 血統書ボタンでモーダルが開く
- [ ] 3世代/5世代の切替が機能する
- [ ] 🖨️ 印刷ボタンが機能する
- [ ] 📄 HTML出力ボタンが機能する

### 検索・フィルタ
- [ ] 名前検索が機能する
- [ ] 性別フィルタが機能する
- [ ] 系統フィルタが機能する

### データ管理
- [ ] 📤 JSONエクスポートが機能する
- [ ] 📤 CSVエクスポートが機能する
- [ ] 📥 JSONインポートが機能する
- [ ] インポート後にリストが更新される

### 統計表示
- [ ] DB統計（個体数、♂/♀数）が表示される

---

## Tab 6: 🛡️ 健康評価 (health)

### ペア健康チェック
- [ ] 父親(♂)選択がDBから読込まれる
- [ ] 母親(♀)選択がDBから読込まれる
- [ ] 「健康チェック」ボタンで評価実行
- [ ] Wright係数（近交係数）が表示される
- [ ] リスクレベル（safe/caution/warning/critical）が色分け表示される
- [ ] 推奨事項が表示される

### 系統別制限ガイド
- [ ] INO系統制限（2世代）が表示される
- [ ] Pallid系統制限（2世代）が表示される
- [ ] Fallow系統制限（2世代）が表示される
- [ ] Dark DF制限（3世代）が表示される

---

## Tab 5: 🎯 作出計画 (planner)

### 目標選択
- [ ] 目標羽色のドロップダウンが表示される
- [ ] カテゴリ別グループ表示が機能する
- [ ] 310+色すべてが選択可能

### 計画実行
- [ ] 「計画を立てる」ボタンで実行
- [ ] DB内の個体から最適ペアが提案される
- [ ] 推奨ペア一覧が表示される
- [ ] 各ペアの作出確率が表示される
- [ ] 近交係数が表示される
- [ ] v7.0: 連鎖遺伝ボーナスが反映される
- [ ] ヘルスガーディアンチェックが適用されている

### 結果表示
- [ ] 空の場合「個体を登録してください」メッセージ
- [ ] 該当ペアなしの場合の警告表示

---

## Tab 1: 🧭 パスファインダー (pathfinder)

### 目標選択
- [ ] 目標羽色のドロップダウンが表示される
- [ ] カテゴリ別グループ表示が機能する

### 経路計算
- [ ] 「経路を探す」ボタンでPOST送信
- [ ] 目標羽色名が結果に表示される
- [ ] 作出ステップが順番に表示される
- [ ] 各ステップで ♂×♀ の組み合わせが表示される
- [ ] 予想される子孫が表示される
- [ ] v7.0: 連鎖遺伝の警告/アドバイスが表示される（該当時）

---

## Tab 2: 🧬 繁殖計算 (feasibility)

### 入力モード
- [ ] ♂ 表現型入力モードが機能する
- [ ] ♂ 遺伝子型直接入力モードが機能する
- [ ] ♂ DB選択モードが機能する
- [ ] ♀ 表現型入力モードが機能する
- [ ] ♀ 遺伝子型直接入力モードが機能する
- [ ] ♀ DB選択モードが機能する

### 表現型入力
- [ ] ベースカラー選択が機能する
- [ ] 目の色選択が機能する
- [ ] ダーク因子選択が機能する

### 遺伝子型直接入力
- [ ] Parblue座位選択が機能する
- [ ] INO座位選択が機能する
- [ ] Dark座位選択が機能する
- [ ] Opaline座位選択が機能する
- [ ] Cinnamon座位選択が機能する
- [ ] Pied座位選択が機能する
- [ ] Violet座位選択が機能する
- [ ] その他座位が機能する

### DB選択
- [ ] 登録済み♂リストが表示される
- [ ] 登録済み♀リストが表示される
- [ ] 選択時に遺伝子型がフォームに反映される

### v7.0 連鎖遺伝モード
- [ ] 連鎖遺伝モードチェックボックスが機能する
- [ ] 父親のZ連鎖相(Cis/Trans/不明)選択が表示される
- [ ] 連鎖モードON時に計算結果が変化する

### 計算実行
- [ ] 「計算」ボタンでPOST送信
- [ ] 子孫確率一覧がカード形式で表示される
- [ ] 各子孫の確率(%)が表示される
- [ ] 性別(♂/♀)が表示される
- [ ] 表現型名が表示される

---

## Tab 3: 🔬 遺伝型推定 (estimator)

### 入力
- [ ] 性別選択が機能する
- [ ] ベースカラー選択が機能する
- [ ] 目の色選択が機能する
- [ ] ダーク因子選択が機能する

### 推定実行
- [ ] 「推定」ボタンでPOST送信
- [ ] 各座位の推定結果が表示される
- [ ] 確定/推定の区別が表示される
- [ ] テスト交配提案が表示される（該当時）

---

## Tab 7: 👨‍👩‍👧‍👦 家系推論 (family)

### ファミリーマップ
- [ ] ファミリーマップUIが表示される
- [ ] 父方祖父母スロットが表示される
- [ ] 父方父スロットが表示される
- [ ] 母方祖父母スロットが表示される
- [ ] 母方母スロットが表示される
- [ ] 対象個体スロットが表示される
- [ ] 子孫スロットが表示される

### 個体配置
- [ ] 空スロットクリックでDB選択モーダルが開く
- [ ] 手動入力モードで個体追加が可能
- [ ] 配置済み個体のクリアが機能する
- [ ] 配置済み個体の編集が機能する

### 推論実行
- [ ] 推論対象の選択が機能する
- [ ] 「推論」ボタンで実行
- [ ] 各座位の推定結果が表示される
- [ ] 確率付き候補が表示される
- [ ] 信頼度が表示される
- [ ] テスト交配提案が表示される（該当時）

### 近交警告
- [ ] 近交係数が高い場合に警告が表示される

---

## カスタムダイアログ

- [ ] customConfirm()がブラウザ標準の代わりに表示される
- [ ] customPrompt()がブラウザ標準の代わりに表示される
- [ ] customSelect()がリスト選択で機能する
- [ ] ESCキーでダイアログがキャンセルされる
- [ ] オーバーレイクリックでダイアログがキャンセルされる

---

## エラーハンドリング

- [ ] 必須フィールド未入力時にエラー表示
- [ ] 無効な入力時に適切なエラーメッセージ
- [ ] ネットワークエラー時の適切なハンドリング
- [ ] データ未登録時の適切なメッセージ

---

## レスポンシブ/アクセシビリティ

- [ ] モバイル表示でレイアウトが崩れない
- [ ] タブナビゲーションがキーボードで操作可能
- [ ] フォーカス状態が視認可能
- [ ] 色のコントラストが十分

---

## 確認日時・結果

| 項目 | 確認者 | 日時 | 結果 |
|------|--------|------|------|
| グローバル機能 | | | |
| 個体管理 | | | |
| 健康評価 | | | |
| 作出計画 | | | |
| パスファインダー | | | |
| 繁殖計算 | | | |
| 遺伝型推定 | | | |
| 家系推論 | | | |

---

## 備考

- v7.0の連鎖遺伝機能は新規追加のため重点的に確認
- デモモードとユーザーモード両方でテスト推奨
- 日本語/英語両言語でUIテスト推奨
